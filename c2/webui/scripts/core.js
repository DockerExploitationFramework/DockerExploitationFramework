GLOBAL={}

function setAgentContextMenu(agentid){
    $(`#${agentid}`).contextMenu({

        menuSelector: "#contextMenu",
        menuSelected: function (invokedOn, selectedMenu) {
            var msg = "You selected the menu item '" + selectedMenu.text() +
                "' on the value '" + invokedOn.get(0).id /*invokedOn.text()*/ + "'" ;
            //console.log(invokedOn[0].id)
            //console.log(invokedOn)
           // alert(invokedOn[0].closest("li[id^='agent_']").id)
           console.log(invokedOn[0].closest("li[id^='agent_']").id)
            console.log(selectedMenu.data("pluginid"))

        }
    });
  }
  

function pollAgent() {
    $.ajax({
        type: "GET",
        url: `${C2_URL}/ui/agents`,
        success: function (data) {
            let agents = data
            $("#agent")[0].innerHTML=""
            for( x in agents ){
                agent_li = Object.assign(
                document.createElement(`li`),
                {
                    classList: "list-group-item d-flex justify-content-between align-items-start",
                    id:`agent_${x}`,
                    innerHTML: `<div class="ms-2 me-auto">
                              <div class="fw-bold" >${x}</div>
                              IP:${agents[x].last_seen} || UID:${agents[x].ip}
                            </div>
                            <span class="badge bg-primary rounded-pill">14</span>`
                });
                $('#agent')[0].appendChild(agent_li)
                setAgentContextMenu(`agent_${x}`);
            }
            
            console.log(data);

        }
    });


}

function pollPlugins() {
    $.ajax({
        type: "GET",
        url: `${C2_URL}/ui/plugins`,
        success: function (data) {
            console.log(data)
            //GLOBAL['plugins'] = JSON.parse(data)
            GLOBAL['plugins'] = data
        

        }
    });


}

setInterval(pollAgent, 1000);
//pollPlugins();
setInterval(pollPlugins, 1000);



