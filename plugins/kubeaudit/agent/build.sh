architecture=""
case $(uname -m) in
    aarch64|arm64)   architecture="aarch64" ;;
    x86_64|amd64) architecture="amd64" ;;
    *) architecture="unsupported";;
esac
echo $architecture

if [ "$architecture" = "aarch64" ]; then 
    curl -s -L https://github.com/Shopify/kubeaudit/releases/download/v0.22.0/kubeaudit_0.22.0_linux_arm64.tar.gz |tar xvzfO - kubeaudit |base64 -w 0 > kubeaudit.txt
fi

if [ "$architecture" = "amd64" ]; then 
curl -s -L https://github.com/Shopify/kubeaudit/releases/download/v0.22.0/kubeaudit_0.22.0_linux_amd64.tar.gz |tar xvzfO - kubeaudit |base64 -w 0 > kubeaudit.txt
fi

if [ "$architecture" = "unsupported" ]; then
    echo "[ERROR] Cannot package kubeaudit"
    exit 1
fi


pyinstaller --onefile --clean --add-data "kubeaudit.txt:." kubeaudit.py
